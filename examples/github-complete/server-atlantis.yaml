repos:
- id: "/.*/"
  workflow: terragrunt
  apply_requirements: [mergeable, approved]
  delete_source_branch_on_merge: true
workflows:
  terragrunt:
    plan:
      steps:
      - env:
          name: TERRAGRUNT_TFPATH
          command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
      - run: terragrunt plan -no-color --terragrunt-non-interactive -out=$PLANFILE
      - run: terragrunt show -no-color --terragrunt-non-interactive -json $PLANFILE > $SHOWFILE
      - run: infracost breakdown --path $SHOWFILE --no-color true
      - run: infracost diff --path $SHOWFILE --no-color true
    apply:
      steps:
      - env:
          name: TERRAGRUNT_TFPATH
          command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
      - run: terragrunt apply -no-color --terragrunt-non-interactive $PLANFILE